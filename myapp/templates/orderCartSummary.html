<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/cart.css' %}" />
</head>

<body class="bg-gray-100">
<div class="cart-items max-w-7xl mx-auto p-6">
    <h2 class="text-2xl font-semibold text-center mb-6">Your Cart</h2>

    <!-- Loop through cart items from the context -->
    {% for item in cart_items %}
    <div class="cart-item flex justify-between items-center bg-red-400 p-4 mb-6 rounded-md shadow-md">
        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-20 h-20 object-cover rounded-lg">
        <div class="item-details flex-grow pl-4">
            <h4 class="text-lg font-semibold text-white">{{ item.product.name }}</h4>
            <p class="text-sm text-white">Price: ${{ item.product.price|floatformat:2 }} | Size: {{ item.product.size }}</p>
        </div>

        <div class="remove-item">
            <button class="remove-btn bg-transparent border-none cursor-pointer flex justify-center items-center w-12">
                <img src="{% static 'icons/Trash1.svg' %}" alt="Remove" class="trash-icon w-6 h-6">
            </button>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // Remove any previous event handlers before attaching a new one
            $('.remove-btn').off('click').on('click', function(event) {
                event.preventDefault(); // Prevent default button behavior

                var cartItemId = $(this).data('id'); // Get the cart item ID from the button's data attribute

                $.ajax({
                    url: '/remove-from-cart/' + cartItemId + '/', // Use the remove URL with the cart item ID
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}' // Include CSRF token for POST requests
                    },
                    success: function(response) {
                        alert(response.message); // Show success message once
                        $('#cart-item-' + cartItemId).remove(); // Remove the item from the DOM
                        location.reload(); // Reload to update totals
                    },
                    error: function(xhr) {
                        alert('Error: ' + xhr.responseJSON.message); // Show error message if something goes wrong
                    }
                });
            });
        });
    </script>
    {% empty %}
    <p class="text-center text-xl text-gray-600">Your cart is empty.</p>
    {% endfor %}
</div>
</body>
